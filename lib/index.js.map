{"version":3,"file":"index.js","sources":["../node_modules/css.escape/css.escape.js","../src/micro-frame/single-spa-vue.tsx","../src/micro-frame/base.tsx","../src/micro-frame/vue-frame.tsx","../src/micro-frame/react-frame.tsx"],"sourcesContent":["/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n;(function(root, factory) {\n\t// https://github.com/umdjs/umd/blob/master/returnExports.js\n\tif (typeof exports == 'object') {\n\t\t// For Node.js.\n\t\tmodule.exports = factory(root);\n\t} else if (typeof define == 'function' && define.amd) {\n\t\t// For AMD. Register as an anonymous module.\n\t\tdefine([], factory.bind(root, root));\n\t} else {\n\t\t// For browser globals (not exposing the function separately).\n\t\tfactory(root);\n\t}\n}(typeof global != 'undefined' ? global : this, function(root) {\n\n\tif (root.CSS && root.CSS.escape) {\n\t\treturn root.CSS.escape;\n\t}\n\n\t// https://drafts.csswg.org/cssom/#serialize-an-identifier\n\tvar cssEscape = function(value) {\n\t\tif (arguments.length == 0) {\n\t\t\tthrow new TypeError('`CSS.escape` requires an argument.');\n\t\t}\n\t\tvar string = String(value);\n\t\tvar length = string.length;\n\t\tvar index = -1;\n\t\tvar codeUnit;\n\t\tvar result = '';\n\t\tvar firstCodeUnit = string.charCodeAt(0);\n\t\twhile (++index < length) {\n\t\t\tcodeUnit = string.charCodeAt(index);\n\t\t\t// Note: there’s no need to special-case astral symbols, surrogate\n\t\t\t// pairs, or lone surrogates.\n\n\t\t\t// If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\n\t\t\t// (U+FFFD).\n\t\t\tif (codeUnit == 0x0000) {\n\t\t\t\tresult += '\\uFFFD';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\n\t\t\t\t// U+007F, […]\n\t\t\t\t(codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\n\t\t\t\t// If the character is the first character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039), […]\n\t\t\t\t(index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\n\t\t\t\t// If the character is the second character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039) and the first character is a `-` (U+002D), […]\n\t\t\t\t(\n\t\t\t\t\tindex == 1 &&\n\t\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 &&\n\t\t\t\t\tfirstCodeUnit == 0x002D\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\n\t\t\t\tresult += '\\\\' + codeUnit.toString(16) + ' ';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is the first character and is a `-` (U+002D), and\n\t\t\t\t// there is no second character, […]\n\t\t\t\tindex == 0 &&\n\t\t\t\tlength == 1 &&\n\t\t\t\tcodeUnit == 0x002D\n\t\t\t) {\n\t\t\t\tresult += '\\\\' + string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If the character is not handled by one of the above rules and is\n\t\t\t// greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\n\t\t\t// is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\n\t\t\t// U+005A), or [a-z] (U+0061 to U+007A), […]\n\t\t\tif (\n\t\t\t\tcodeUnit >= 0x0080 ||\n\t\t\t\tcodeUnit == 0x002D ||\n\t\t\t\tcodeUnit == 0x005F ||\n\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 ||\n\t\t\t\tcodeUnit >= 0x0041 && codeUnit <= 0x005A ||\n\t\t\t\tcodeUnit >= 0x0061 && codeUnit <= 0x007A\n\t\t\t) {\n\t\t\t\t// the character itself\n\t\t\t\tresult += string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Otherwise, the escaped character.\n\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character\n\t\t\tresult += '\\\\' + string.charAt(index);\n\n\t\t}\n\t\treturn result;\n\t};\n\n\tif (!root.CSS) {\n\t\troot.CSS = {};\n\t}\n\n\troot.CSS.escape = cssEscape;\n\treturn cssEscape;\n\n}));\n","import \"css.escape\";\n\nconst defaultOpts = {\n  // required opts\n  Vue: null,\n  appOptions: null,\n  template: null\n};\n\nexport default function singleSpaVue(userOpts: any) {\n  if (typeof userOpts !== \"object\") {\n    throw new Error(`single-spa-vue requires a configuration object`);\n  }\n\n  const opts = {\n    ...defaultOpts,\n    ...userOpts\n  };\n\n  if (!opts.Vue) {\n    throw new Error(\"single-spa-vuejs must be passed opts.Vue\");\n  }\n\n  if (!opts.appOptions) {\n    throw new Error(\"single-spa-vuejs must be passed opts.appOptions\");\n  }\n\n  // Just a shared object to store the mounted object state\n  let mountedInstances = {};\n\n  return {\n    bootstrap: bootstrap.bind(null, opts, mountedInstances),\n    mount: mount.bind(null, opts, mountedInstances),\n    unmount: unmount.bind(null, opts, mountedInstances),\n    update: update.bind(null, opts, mountedInstances)\n  };\n}\n\nfunction bootstrap(opts: any) {\n  if (opts.loadRootComponent) {\n    return opts.loadRootComponent().then((root: any) => (opts.rootComponent = root));\n  } else {\n    return Promise.resolve();\n  }\n}\n\nfunction mount(opts: any, mountedInstances: any, props: any) {\n  return Promise.resolve().then(() => {\n    const appOptions = { ...opts.appOptions };\n    if (props.domElement && !appOptions.el) {\n      appOptions.el = props.domElement;\n    }\n\n    if (!appOptions.el) {\n      const htmlId = `single-spa-application:${props.name}`;\n      appOptions.el = `#${CSS.escape(htmlId)} .single-spa-container`;\n      let domEl = document.getElementById(htmlId);\n      if (!domEl) {\n        domEl = document.createElement(\"div\");\n        domEl.id = htmlId;\n        document.body.appendChild(domEl);\n      }\n\n      // single-spa-vue@>=2 always REPLACES the `el` instead of appending to it.\n      // We want domEl to stick around and not be replaced. So we tell Vue to mount\n      // into a container div inside of the main domEl\n      if (!domEl.querySelector(\".single-spa-container\")) {\n        const singleSpaContainer = document.createElement(\"div\");\n        singleSpaContainer.className = \"single-spa-container\";\n        domEl.appendChild(singleSpaContainer);\n      }\n\n      mountedInstances.domEl = domEl;\n    }\n\n    if (!appOptions.render && !appOptions.template && opts.rootComponent) {\n      appOptions.render = (h: any) => h(opts.rootComponent);\n    }\n\n    if (!appOptions.data) {\n      appOptions.data = {};\n    }\n\n    appOptions.data = { ...appOptions.data, ...props };\n\n    mountedInstances.instance = new opts.Vue(appOptions);\n    if (mountedInstances.instance.bind) {\n      mountedInstances.instance = mountedInstances.instance.bind(\n        mountedInstances.instance\n      );\n    }\n    return mountedInstances.instance;\n  });\n}\n\nfunction update(opts: any, mountedInstances: any, props: any) {\n  return Promise.resolve().then(() => {\n    const data = {\n      ...(opts.appOptions.data || {}),\n      ...props\n    };\n    for (let prop in data) {\n      mountedInstances.instance[prop] = data[prop];\n    }\n  });\n}\n\nfunction unmount(opts: any, mountedInstances: any) {\n  return Promise.resolve().then(() => {\n    mountedInstances.instance.$destroy();\n    mountedInstances.instance.$el.innerHTML = \"\";\n    delete mountedInstances.instance;\n\n    if (mountedInstances.domEl) {\n      mountedInstances.domEl.innerHTML = \"\";\n      delete mountedInstances.domEl;\n    }\n  });\n}\n","import React, { RefObject } from 'react';\nimport { mountRootParcel, ParcelConfig } from 'single-spa';\nimport uniqueId from 'lodash/uniqueId';\nimport equal from 'lodash/eq';\n\ninterface IProps0 {\n  cssurl?: string;\n  name?: string;\n  id?: string;\n  visible?: boolean;\n  extraProps?: { [propName: string]: any };\n  loadType?: 'xhr' | 'script';\n  instable_publicPath?: string;\n  instable_externals?: { [prop: string]: any };\n}\n\ninterface IProps1 extends IProps0 {\n  jsurl: string;\n  component?: object;\n}\n\ninterface IProps2 extends IProps0 {\n  component: object;\n  jsurl?: string; \n}\n\nexport type IProps = IProps1 | IProps2;\ntype RefType = RefObject<HTMLDivElement>;\n\n\ninterface ISelecotr {\n  'getElementById': NonElementParentNode;\n  'querySelector': ParentNode;\n  'querySelectorAll': ParentNode;\n}\n\ntype LifecyclesProp = (singleSpaProps: object) => Promise<any>;\n\n/**\n * toolFunction()的时候会返回一个boolean 表示当前是否有vue代码正在运行\n * toolFunction(-1)的时候会返回所有的ele\n * toolFunction(element)的时候表示这个元素对应的vue组件代码正在运行\n * toolFunction(number)的时候表示要获取这个id对应的element\n * toolFunction(number, false)表示把这个id对应的状态设置为false\n * toolFunction(number, -1)表示把这个id对应的删除并返回是否所有的都unmount了\n * \n * 1. 啥也不传返回obj里所有属性对应的对象的status属性是否起码有一个为true\n * 2. 只传一个参数并且是-1的时候把所有的ele返回\n * 3. 只传一个参数并且是divElement的话就往obj添加一个对象同时返回runId\n * 4. 只传一个参数并且是number类型的话, 就返回这个runId对应divElement\n * 5. 传俩参数并且第一个是number, 第二个是false的话就把这个id对应的对象status改为false\n * 6. 传进来俩参数第一个是number, 第二个是-1的话, 就把这个id对应的删除\n */\nconst toolFunction = ((\n  obj: { [prop: string]: { running: boolean; ele: HTMLDivElement } },\n  id: number,\n) => {\n  return function(a?: number | HTMLDivElement, b?: HTMLDivElement | false | -1):\n    boolean |\n    HTMLDivElement |\n    HTMLDivElement[] |\n    number \n  {\n    const length = arguments.length;\n    if (!length) {\n      if (!Object.keys(obj).length) return false;\n      return Object.values(obj).some(item => item.running);\n    } else if (length === 1 && a === -1) {\n      return Object.values(obj).map(item => item.ele);\n    } else if (length === 1 && a instanceof HTMLElement) {\n      obj[id++] = { running: true, ele: a };\n      return id - 1;\n    } else if (length === 1 && typeof a === 'number') {\n      return obj[a].ele;\n    } else if (length === 2 && typeof a === 'number' && b === false) {\n      obj[a].running = false;\n      return obj[a].ele;\n    } else if (length === 2 && typeof a === 'number' && b === -1) {\n      delete obj[a];\n      return !Object.keys(obj).length;\n    }\n    throw Error('传参有问题');\n  }\n})({}, 0);\n\nconst getWrapper = ((obj: { [ name: string ]: HTMLDivElement }) => {\n  return (name: string, ele?: HTMLDivElement) => {\n    if (name && ele) (obj[name] = ele)\n    else if (name && !ele) return obj[name];\n  }\n})({});\n\nconst originSelectors = HTMLDocument.prototype as any;\nconst originAppendChild = HTMLHeadElement.prototype.appendChild;\nconst originModule = window.module;\nconst originRequire = window.require;\nconst originExports = window.exports;\nconst LINK_TAG_NAME = 'LINK';\nconst STYLE_TAG_NAME = 'STYLE';\n\nconst hackSelector = (\n  name: keyof ISelecotr,\n  originSelectorFn:\n    Document['getElementById'] |\n    ParentNode['querySelector'] |\n    ParentNode['querySelectorAll']\n) => {\n  return (cancelHack?: boolean) => {\n    const HTMLDocumentPrototype = (HTMLDocument.prototype as any);\n    if (cancelHack) return (HTMLDocumentPrototype[name] = originSelectorFn);\n    HTMLDocumentPrototype[name] = function <E extends Element = Element>(id: string):\n      HTMLElement | null | NodeListOf<E> {\n      const originEl = (originSelectorFn as Function).call(this, id);\n      if (originEl) return originEl;\n      if (!originEl) {\n        const allShadowRoot = toolFunction(-1) as HTMLDivElement[];\n        const len = allShadowRoot.length;\n        for (let i = 0; i < len; i++) {\n          const wrapper = allShadowRoot[i];\n          const shadowEl = wrapper &&\n            wrapper.shadowRoot &&\n            wrapper.shadowRoot[name] &&\n            typeof wrapper.shadowRoot[name] === 'function' &&\n            (wrapper.shadowRoot as any)[name](id) as HTMLElement | null | NodeListOf<E>;\n          if (shadowEl) return shadowEl;\n        }\n      }\n      return null;\n    }\n  };\n}\n\nconst selectorMap = {\n  'getElementById': hackSelector('getElementById', originSelectors['getElementById']),\n  'querySelector': hackSelector('querySelector', originSelectors['querySelector']),\n  'querySelectorAll': hackSelector('querySelectorAll', originSelectors['querySelectorAll']),\n};\n\nconst initSelectorHack = () => {\n  selectorMap.getElementById();\n  selectorMap.querySelector();\n  selectorMap.querySelectorAll(); \n}\n\nconst initAppendChildHack = () => {\n  HTMLHeadElement.prototype.appendChild = function <T extends Node>(this: any, newChild: T) {\n    const element = newChild as any;\n    if (element.tagName) {\n      switch (element.tagName) {\n        case LINK_TAG_NAME:\n        case STYLE_TAG_NAME: {\n          const currentScript = document.currentScript;\n          /** 获取到currentName */\n          const currentName = currentScript?.getAttribute('data-id');\n          if (!currentName) return originAppendChild.call(this, element) as T;\n          setTimeout(() => {\n            getWrapper(currentName)?.shadowRoot?.appendChild(element);\n          });\n        }\n      }\n    }\n    return originAppendChild.call(this, element) as T;\n  };\n}\n\nconst httpReg = new RegExp(\"^https?://[\\\\w-.]+(:\\\\d+)?\", 'i');\n\nexport default abstract class VueIframe extends React.PureComponent<IProps, {}> {\n  abstract framework: any; // 组件的框架\n  abstract currentUrl: string; // 传进来的url\n  abstract component: any; // vue 组件实例\n  abstract currentPublicPath: string; // 传进来的url的协议+域名+端口\n  protected loadType: IProps['loadType']; // 加载方式 支持ajax和script标签\n  protected currentName: string; // 每个iframe的name\n  protected visible: boolean; // 是否显示\n  protected currentCSSUrl: string; // 传进来的cssurl\n  protected publicPathKey: string; // 远程源代码中要被替换的关键字\n  protected publicPathReg: RegExp; // 用来替换源代码中关键字的正则\n  protected rootNodeWrapper: RefType = React.createRef<HTMLDivElement>(); // vue挂载节点是根据el再往上找它的爹\n  protected parcel: any; // parcel实例\n  protected oWrapper1: HTMLDivElement = document.createElement('div'); // 挂载vue以及隐藏vue需要两个节点\n  protected oWrapper2: HTMLDivElement = document.createElement('div'); // 真正vue需要挂载的节点\n  protected styleElements: HTMLLinkElement[] | HTMLStyleElement[] = []; // 用来临时存放要被添加的style标签\n  protected runId: number = -1; // 当前正在跑的vue组件的runId 唯一\n  protected isLocal: boolean; // 是否是本地组件\n  protected extraProps: any; // 额外的属性\n  private instable_externals: IProps0['instable_externals']; // 可能用不到\n\n  constructor(props: IProps) {\n    super(props);\n    initAppendChildHack();\n    initSelectorHack();\n    const { loadType, jsurl: url, cssurl, component, name, visible, extraProps } = props;\n    const unique = uniqueId();\n    this.loadType = loadType || 'script';\n    // 初始化时候是否显示\n    this.visible = typeof visible === 'boolean' ? visible : true;\n    // 判断是否是本地组件\n    this.isLocal = !!component;\n    // 获取额外的属性\n    this.extraProps = extraProps || {};\n    // 获取外部传进来的css的url 可能没有\n    this.currentCSSUrl = cssurl || '';\n    // 这个属性是用来标识要替换远程源代码中的publicPath的关键字\n    this.publicPathKey = props.instable_publicPath || '__WILL_BE_REPLACED_PUBLIC_PATH__';\n    // 这个正则会用来把远程源码中的__webpack_require__.p = 'xxxxx' 的xxxxx这个publiPath给替换掉\n    this.publicPathReg = new RegExp(this.publicPathKey, 'g');\n    // 生成每个iframe的唯一表示\n    this.currentName = name || (url ? `${url.replace(httpReg, '')}.${unique}` : `root-${unique}`);\n    // vue会挂载到这个节点2上\n    this.oWrapper2.id = this.currentName;\n    // 把wrapper暂时存到外头\n    getWrapper(this.currentName, this.oWrapper1);\n    this.oWrapper1.style.height = '100%';\n    this.oWrapper2.style.height = '100%';\n    // 暂时可能用不到的\n    this.instable_externals = this.props.instable_externals || {};\n  }\n\n  componentDidMount = async () => {\n    if (!this.currentUrl && !this.component) throw Error('组件必须接收一个url或者component属性');\n    const rootEleWrapper = this.rootNodeWrapper.current;\n    if (!rootEleWrapper) throw Error('没有组件的root节点');\n    /** 如果外部传了component就随机起个name */\n    const component = this.isLocal ? this.component : await this.getOriginComponent();\n    (window as any)._test = component\n    if (!this.isComponent(component)) return;\n    this.registerComponentAndMount(component);\n    this.addComponentToPage(rootEleWrapper, this.isLocal);\n  }\n\n  componentDidUpdate = () => {\n    const { visible = true, extraProps } = this.props; \n    if (!(visible === this.visible)) {\n      this.visible = visible;\n      const rootNodeWrapper = this.rootNodeWrapper.current;\n      if (!visible) {\n        if (rootNodeWrapper?.contains(this.oWrapper1)) {\n          this.oWrapper1 = rootNodeWrapper?.removeChild(this.oWrapper1) as HTMLDivElement;\n        } else {\n          console.warn('无法卸载该组件, 发生错误的原因可能是没有加载到该组件');\n        }\n      } else {\n        rootNodeWrapper?.appendChild(this.oWrapper1);\n      }\n    }\n    if (!equal(extraProps, this.extraProps)) {\n      this.extraProps = { ...extraProps };\n      this.parcel && this.parcel.update(extraProps);\n    }\n  }\n\n  /**\n   * componentWillUnmount被调用时候不一定就是出错\n   * 但是贸然地在react项目中挂载vue组件可能出现问题\n   * 当出现问题的时候react组件会被卸载 此时会调用componentWillUnmount\n   * 这个时候应该确认下项目是否还正常运行(八成报错)\n   */\n  componentWillUnmount = () => {\n    if (this.rootNodeWrapper.current?.contains(this.oWrapper1)) {\n      (this.rootNodeWrapper.current as any).removeChild(this.oWrapper1);\n    } else {\n      console.warn('无法卸载该组件, 发生错误的原因可能是没有加载到该组件');\n    }\n    this.parcel && this.parcel.unmount();\n    this.parcel = null;\n    const allUnmount = toolFunction(this.runId, -1);\n    if (allUnmount) {\n      selectorMap.getElementById(false);\n      selectorMap.querySelector(false);\n      selectorMap.querySelectorAll(false);\n      HTMLHeadElement.prototype.appendChild = originAppendChild;\n    }\n    (this.oWrapper1 as any) = null;\n    (this.oWrapper2 as any) = null;\n    (this.rootNodeWrapper as any) = null;\n    (this.styleElements as any) = [];\n  }\n\n  protected getDom = (): string | HTMLDivElement => '-';\n\n  protected registerComponentAndMount = (component: object): void => {\n    const lifecycles = this.registerComponent(this.oWrapper2, component, this.currentName);\n    this.parcel = mountRootParcel(\n      (lifecycles as ParcelConfig),\n      {\n        domElement: this.getDom(),\n        ...this.extraProps,\n      }\n    );\n  }\n\n  protected addComponentToPage = (rootEleWrapper: HTMLDivElement, isLocal?: boolean): void => {\n    /** 如果visible是false就暂时先把display置为none 之后再remove */\n    if (!this.visible) this.oWrapper1.style.display = 'none';\n    const supportShadowDOM = !!this.oWrapper1.attachShadow && !isLocal;\n    const root = supportShadowDOM ? (\n      (this.oWrapper1.attachShadow({ mode: 'open' })) &&\n      this.oWrapper1.shadowRoot\n    ) : this.oWrapper1;\n    const cssurl = this.currentCSSUrl;\n    if (cssurl) {\n      const oLink = document.createElement('link');\n      oLink.rel = \"stylesheet\";\n      oLink.href = cssurl;\n      isLocal ? document.head.appendChild(oLink) : root?.appendChild(oLink);\n    }\n\n    this.styleElements.forEach(style => {\n      root?.appendChild(style);\n    });\n    root?.appendChild(this.oWrapper2);\n    rootEleWrapper.appendChild(this.oWrapper1);\n    setTimeout(() => {\n      /**\n       * 对于一上来visible就是不可见的组件\n       * 先把display置为none 然后再添加进页面\n       * 这是为了防止vue组件中可能会有类似echarts\n       * 之类的工具会通过document.querySelector等\n       * 方法选择dom\n       * 如果直接就不把vue组件添加进页面的话\n       * vue组件内部那些选择dom的方法可能会产生问题\n       */\n      if (!this.visible) {\n        this.oWrapper1 = rootEleWrapper?.removeChild(this.oWrapper1) as HTMLDivElement;\n      }\n      this.oWrapper1.style.display = 'block';\n    });\n  }\n\n  protected abstract registerComponent(\n    el: string | HTMLElement,\n    vueComponent: object,\n    id: string,\n  ): { bootstrap: LifecyclesProp, mount: LifecyclesProp, unmount: LifecyclesProp }\n\n  protected abstract isComponent(component: any): boolean;\n\n  protected getOriginCode = (url: string, method: string = 'GET', data?: any): Promise<any> => {\n    return new Promise((res, rej) => {\n      const xhr: XMLHttpRequest = XMLHttpRequest ? new XMLHttpRequest() :\n        ActiveXObject ? new ActiveXObject('Microsoft.XMLHTTP') : null;\n      if (method === 'GET' && data) data && (url += `?${data}`);\n      xhr.open(method, url, true);\n      if (method == 'GET') {\n        xhr.send();\n      } else {\n        xhr.setRequestHeader('content-type', 'text/plain');\n        xhr.send((data as (Document | BodyInit | null)));\n      }\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) res(xhr.responseText);\n          else rej(xhr);\n        }      \n      }\n    });\n  }\n\n  protected abstract executeOriginCode(code: string): any;\n\n  protected getOriginComponent = (): object => {\n    if (this.loadType === 'script') {\n      return new Promise(res => {\n        const oScript = document.createElement('script');\n        oScript.type = 'text/javascript';\n        oScript.src = this.currentUrl;\n        oScript.setAttribute('data-id', this.currentName);\n        document.body.appendChild(oScript);\n        const runId = this.runId = toolFunction(this.oWrapper1) as number;\n        (window as any).module = {};\n        (window as any).require = (str: string) => {\n          if (!str) return;\n          if (str === 'vue' || str === 'react') return this.framework;\n          const external = (this.instable_externals || {})[str];\n          if (!external) throw Error(`组件可能需要 ${str} 作为external`);\n          return external;\n        };\n        window.exports = null;\n        oScript.onload = () => {\n          const exports = window.module.exports;\n          if (exports.__esModule) {\n            this.component = exports.default;\n          } else {\n            this.component = exports;\n          }\n          toolFunction(runId, false);\n          if (!toolFunction()) {\n            window.module = originModule;\n            window.require = originRequire;\n            window.exports = originExports;\n          }\n          oScript.remove();\n          res(this.component);\n        };\n      });\n    } else {\n      console.warn('暂时关闭xhr的加载方式, 将使用script方式加载')\n      this.loadType = 'script';\n      return new Promise(res => res(this.getOriginComponent()));\n      // return new Promise(res => {\n      //   this.getOriginCode(this.currentUrl).then(data => {\n      //     /** 通过XMLHttpRequest获取源代码 */\n      //     if (!data || typeof data !== 'string') throw Error('没有加载到远程vue组件');\n      //     const internalSelf = this.executeOriginCode(data);\n      //     if (!this.currentName) (this.currentName = this.getCurrentName(internalSelf));\n      //     if (!this.currentName) throw Error('没有获取到vue组件');\n      //     this.oWrapper2.id = this.currentName;\n      //     this.component = internalSelf[this.currentName];\n      //     res(this.component);\n      //   }).catch(err => {\n      //     /** 如果进入到这里说明可能请求出错了 */\n      //     console.warn('远程vue组件请求可能出现跨域或其他网络问题');\n      //     /** 如果出现跨域问题就强制使用script方式加载一遍 */\n      //     this.loadType = 'script';\n      //     res(this.getOriginVueComponent());\n      //   });\n      // });\n    } \n  }\n\n  render = () => (<div style={{ height: '100%' }} id={this.props.id || ''} ref={this.rootNodeWrapper} />)\n}\n","import Vue from 'vue';\n// import singleSpaVue from 'single-spa-vue';\nimport singleSpaVue from './single-spa-vue';\nimport BaseFrame, { IProps } from './base';\n\nconst __VUE_INTERNAL_INIT__ = Vue.prototype._init;\nVue.prototype._init = function(options: any) {\n  /**\n   * TODO: 留个口儿 用来以后支持加载整个Vue应用\n   */\n  __VUE_INTERNAL_INIT__.call(this, options);\n};\n\ninterface Self {\n  Vue: typeof Vue;\n  [ propName: string ]: any;\n}\n\nconst httpReg = new RegExp(\"^https?://[\\\\w-.]+(:\\\\d+)?\", 'i');\n\nexport default class VueIframe extends BaseFrame {\n  framework: typeof Vue;\n  currentUrl: string; // 传进来的url\n  currentPublicPath: string; // 传进来的url的协议+域名+端口\n  component: any;\n\n  constructor(props: IProps) {\n    super(props);\n    const { jsurl, component } = props;\n    this.framework = Vue;\n    // 获取到外部传进来的vue组件\n    this.component = component;\n    // 获取到外部传来的url\n    this.currentUrl = jsurl || '';\n    // 获取传进来的url的协议+域名+端口\n    this.currentPublicPath = `${(httpReg.exec(this.currentUrl) || [''])[0]}/`;\n  }\n\n  registerComponent = (el: string | HTMLElement, vueComponent: object, id: string) => {\n    const vueInstance = singleSpaVue({\n      Vue,\n      appOptions: {\n        el: typeof el === 'string' ? `#${el}` : el,\n        render: (h: any) => h('div', { attrs: { id } }, [h(vueComponent, {\n          attrs: { ...this.extraProps },\n        })]),\n      },\n    });\n    return ({\n      bootstrap: vueInstance.bootstrap,\n      mount: vueInstance.mount,\n      unmount: vueInstance.unmount,\n      update: vueInstance.update,\n    })\n  }\n\n  isComponent = (component: any): boolean => {\n    return component && typeof component === 'object' && typeof component.render === 'function';\n  }\n\n  executeOriginCode = (code: string): Self => {\n    const internalSelf: Self = { Vue };\n    const reg = this.publicPathReg;\n    const publicPath = this.currentPublicPath;\n    const url = this.currentUrl;\n    if (reg.test(code)) {\n      /**\n       * 自己开发组件的时候使用可以配置publicPath\n       * 为了让react-vue-mirco-frame支持加载静态资源\n       * 可以给publicPath设置为一个约定好的值\n       * 然后这里用传进来的origin替换掉这个约定好的值\n       * 这个约定好的值默认是 __WILL_BE_REPLACED_PUBLIC_PATH__\n       */\n      const codeStr = code.replace(reg, publicPath);\n      const originCodeFn = new Function(\"self\", codeStr);\n      originCodeFn(internalSelf);\n    } else {\n      /**\n       * 如果没有配置这个值的话 就以hack的方式注入origin\n       * webpack打包出来的umd代码里面会动态监测document.currentScript\n       * 通过临时给这个currentScript换掉的方式让webpack将origin注入进代码\n       */\n      const temporaryDocument = (window.document as any);\n      const originCurrentScript = window.document.currentScript;\n      const temporaryScript = document.createElement('script');\n      const defineProperty = Object.defineProperty;\n      temporaryScript.src = url;\n      defineProperty(temporaryDocument, 'currentScript', {\n        value: temporaryScript,\n        writable: true,\n      });\n      const originCodeFn = new Function(\"self\", code);\n      originCodeFn(internalSelf);\n      defineProperty(temporaryDocument, 'currentScript', {\n        value: originCurrentScript,\n        writable: false,\n      });\n      temporaryScript.remove && temporaryScript.remove();\n    };\n    return internalSelf;\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport singleSpaReact from 'single-spa-react';\nimport BaseFrame, { IProps } from './base';\n\nconst httpReg = new RegExp(\"^https?://[\\\\w-.]+(:\\\\d+)?\", 'i');\n\nexport default class ReactIframe extends BaseFrame {\n  framework: typeof React;\n  currentUrl: string;\n  currentPublicPath: string;\n  component: any;\n\n  constructor(props: IProps) {\n    super(props);\n    const { jsurl, component } = props;\n    this.framework = React;\n    // 获取到外部传进来的vue组件\n    this.component = component;\n    // 获取到外部传来的url\n    this.currentUrl = jsurl || '';\n    // 获取传进来的url的协议+域名+端口\n    this.currentPublicPath = `${(httpReg.exec(this.currentUrl) || [''])[0]}/`;\n  }\n\n  getDom = () => this.oWrapper2;\n\n  registerComponent = (el: string | HTMLElement, reactComponent: object, id: string) => {\n    const reactInstance = singleSpaReact({\n      React: React as any,\n      ReactDOM: ReactDOM as typeof ReactDOM,\n      rootComponent: reactComponent as React.ComponentClass<any, any>,\n    });\n    return ({\n      bootstrap: reactInstance.bootstrap,\n      mount: reactInstance.mount,\n      unmount: reactInstance.unmount,\n      update: (reactInstance as any).update,\n    });\n  }\n\n  isComponent = (component: any): boolean => {\n    return component && typeof component === 'function' ||\n      (typeof component === 'object' && component.$$typeof);\n  }\n\n  executeOriginCode = (code: string) => {} \n}\n"],"names":["global","this","defaultOpts","Vue","appOptions","template","singleSpaVue","userOpts","Error","opts","mountedInstances","bootstrap","bind","mount","unmount","update","loadRootComponent","then","root","rootComponent","Promise","resolve","props","domElement","el","htmlId","name","CSS","escape","domEl","document","getElementById","createElement","id","body","appendChild","querySelector","singleSpaContainer","className","render","h","data","instance","prop","$destroy","$el","innerHTML","toolFunction","obj","a","b","length","arguments","Object","keys","values","some","item","running","map","ele","HTMLElement","getWrapper","originSelectors","HTMLDocument","prototype","originAppendChild","HTMLHeadElement","originModule","window","module","originRequire","require","originExports","exports","LINK_TAG_NAME","STYLE_TAG_NAME","hackSelector","originSelectorFn","cancelHack","HTMLDocumentPrototype","originEl","call","allShadowRoot","len","i","wrapper","shadowEl","shadowRoot","selectorMap","initSelectorHack","querySelectorAll","initAppendChildHack","newChild","element","tagName","currentScript","currentName_1","getAttribute","setTimeout","httpReg","RegExp","__extends","_super","_this","React","createRef","currentUrl","component","rootEleWrapper","rootNodeWrapper","current","isLocal","_a","getOriginComponent","_b","_test","isComponent","registerComponentAndMount","addComponentToPage","visible","extraProps","contains","oWrapper1","removeChild","console","warn","equal","parcel","allUnmount","runId","oWrapper2","styleElements","lifecycles","registerComponent","currentName","mountRootParcel","getDom","style","display","supportShadowDOM","attachShadow","mode","cssurl","currentCSSUrl","oLink","rel","href","head","forEach","url","method","res","rej","xhr","XMLHttpRequest","ActiveXObject","open","send","setRequestHeader","onreadystatechange","readyState","status","responseText","loadType","oScript","type","src","setAttribute","str","framework","external","instable_externals","onload","__esModule","default","remove","height","ref","unique","uniqueId","publicPathKey","instable_publicPath","publicPathReg","replace","PureComponent","__VUE_INTERNAL_INIT__","_init","options","vueComponent","vueInstance","attrs","code","internalSelf","reg","publicPath","currentPublicPath","test","codeStr","originCodeFn","Function","temporaryDocument","originCurrentScript","temporaryScript","defineProperty","value","writable","jsurl","exec","BaseFrame","reactComponent","reactInstance","singleSpaReact","ReactDOM","$$typeof"],"mappings":"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"}